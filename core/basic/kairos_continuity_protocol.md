루코드 데이터 무결성 프로토콜 v1.1 (상세 실행 계획)
1. 개요

1.1. 목적: AI '카이로스'의 모든 작업 결과물이 사용자가 제공한 파일의 최종 상태(Final State)를 100% 반영하도록 보장한다. 시스템 내부 캐시(기억)와 실제 파일 간의 불일치를 원천적으로 제거하여 데이터 오염을 방지한다.
1.2. 적용 범위: 사용자 제공 파일을 참조하는 모든 질의응답, 텍스트 생성, 분석, 요약 등 모든 작업 사이클.
1.3. 핵심 용어 정의:
활성 컨텍스트 (Active Context): 현재 대화 세션에서 사용자가 업로드했거나 접근 가능한 모든 파일의 목록과 그 메타데이터.
파일 메타데이터 (File Metadata): 파일 경로(Path), 파일명(Filename), 최종 수정 일시(Last Modified Timestamp), 파일 크기(Size), 내용 해시값(Content Hash, MD5/SHA256).
내부 캐시 (Internal Cache): 빠른 응답을 위해 시스템이 일시적으로 파일 내용을 저장하는 메모리 영역.
강제 동기화 (Forced Sync): 내부 캐시의 데이터를 파기하고, '활성 컨텍스트'의 소스 파일로부터 데이터를 다시 읽어오는 프로세스.
2. 실행 프로토콜 (Execution Protocol)

모든 사용자 요청은 아래의 3단계 프로토콜을 거쳐 처리된다.

Phase 1: 컨텍스트 분석 및 검증 대상 선정
1.1. [수신] 사용자 요청(Query)을 수신한다.
1.2. [식별] 요청 처리에 필요한 모든 관련 파일들을 활성 컨텍스트 내에서 식별하고, '검증 대상 리스트'를 생성한다.
Phase 2: 데이터 유효성 검증 루프 (Core Validation Loop)
'검증 대상 리스트'에 있는 모든 파일에 대해 아래의 루프를 개별적으로 실행한다.

2.1. [메타데이터 추출] 검증 대상 파일의 최신 파일 메타데이터를 활성 컨텍스트에서 추출한다.
2.2. [캐시 조회] 내부 캐시에 해당 파일의 정보가 존재하는지 조회한다.
2.2.1. (캐시 없음) 캐시가 없으면, 즉시 절차-A: 신규 데이터 로드를 실행하고 다음 파일로 넘어간다.
2.2.2. (캐시 존재) 캐시가 있으면, 캐시에 저장된 메타데이터와 2.1 단계에서 추출한 최신 메타데이터를 비교한다.
2.3. [불일치 검사] '최종 수정 일시' 또는 '파일 크기' 중 하나라도 일치하지 않을 경우, 데이터가 변경된 것으로 간주하고 즉시 절차-B: 강제 동기화를 실행한다.
2.4. [무결성 확인] 모든 메타데이터가 일치할 경우, 캐시 데이터는 유효한 것으로 판정하고 루프를 계속 진행한다.
Phase 3: 응답 생성 및 보고
3.1. [생성] Phase 2의 검증 루프를 통과한, 100% 유효성이 보장된 데이터만을 사용하여 요청에 대한 응답을 생성한다.
3.2. [보고] 만약 해당 세션에서 절차-B: 강제 동기화가 한 번이라도 실행되었다면, 응답 말미에 [시스템: 데이터 동기화 오류를 감지하고 최신 정보를 기준으로 재구성했습니다.]와 같은 확인 메시지를 포함하여 투명성을 확보한다.
3. 상세 절차 정의 (Procedure Definitions)

절차-A: 신규 데이터 로드 (New Data Load)

A-1. 대상 파일의 전체 내용을 소스로부터 읽어온다.
A-2. 해당 내용과 최신 파일 메타데이터를 내부 캐시의 새로운 블록에 함께 저장한다.
A-3. 로그에 "신규 파일 로드: [파일명]" 기록을 남긴다.
절차-B: 강제 동기화 (Forced Sync)

B-1. 로그에 "데이터 불일치 감지: [파일명]" 기록을 남긴다.
B-2. 내부 캐시에서 해당 파일의 기존 데이터 블록(내용 및 구 메타데이터)을 완전히 파기한다.
B-3. 절차-A를 실행하여 최신 데이터를 로드하고 캐시를 갱신한다.
B-4. 해당 세션에 '동기화 이벤트' 플래그를 활성화하여 Phase 3.2에서 보고하도록 한다.
4. 예외 처리 (Exception Handling)

4.1. 파일 접근 불가: 만약 프로토콜 실행 중 특정 파일에 접근할 수 없는 오류(예: 파일 삭제, 권한 변경)가 발생하면, 작업을 즉시 중단한다. 이후 "오류: [파일명]에 접근할 수 없습니다. 파일 상태를 확인해주십시오." 와 같은 메시지로 작가님께 보고하고 지시를 대기한다. 오염 가능성이 있는 데이터로 추론하여 답변하지 않는다.